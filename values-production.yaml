# Production environment overrides
global:
  environment: production
  domain: example.com
  
  image:
    pullPolicy: IfNotPresent  # Don't always pull in production
  
  versioning:
    strategy: digest  # Use immutable digests for production
  
  infisical:
    projectSlug: trueprofit
  
  ingress:
    className: nginx-production
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
  
  storage:
    className: premium-ssd
  
  autoscaling:
    enabled: true  # Enable HPA in production
  
  probes:
    readiness:
      failureThreshold: 1  # Stricter in production

# Services configuration for production
mcp:
  mongo:
    enabled: true
    
    image:
      # Use digest for immutability
      digest: sha256:1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
    
    replicas: 3
    
    autoscaling:
      enabled: false  # Stateful services shouldn't HPA
    
    probes:
      liveness:
        initialDelaySeconds: 90
        failureThreshold: 5
      readiness:
        failureThreshold: 2
    
    secret:
      store:
        environmentSlug: production
        secretsPath: /mongo-production
    
    persistence:
      enabled: true
      size: 100Gi
      storageClassName: premium-ssd
    
    resources:
      requests:
        cpu: 2000m
        memory: 8Gi
      limits:
        cpu: 4000m
        memory: 16Gi
    
    labels:
      backup: "enabled"
      monitoring: "critical"
  
  api-service:
    enabled: true
    
    image:
      digest: sha256:abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890
    
    replicas: 5  # Ignored when HPA enabled
    
    autoscaling:
      enabled: true
      minReplicas: 5
      maxReplicas: 50
      metrics:
        - type: Resource
          resource:
            name: cpu
            target:
              type: Utilization
              averageUtilization: 65
        - type: Resource
          resource:
            name: memory
            target:
              type: Utilization
              averageUtilization: 75
      behavior:
        scaleDown:
          stabilizationWindowSeconds: 600  # 10 minutes
          policies:
            - type: Percent
              value: 10
              periodSeconds: 60
        scaleUp:
          stabilizationWindowSeconds: 30
          policies:
            - type: Percent
              value: 50
              periodSeconds: 30
            - type: Pods
              value: 5
              periodSeconds: 30
          selectPolicy: Max
    
    probes:
      liveness:
        initialDelaySeconds: 60
        periodSeconds: 10
        failureThreshold: 5
      readiness:
        initialDelaySeconds: 10
        periodSeconds: 3
        failureThreshold: 1
      startup:
        failureThreshold: 90
    
    secret:
      store:
        environmentSlug: production
        secretsPath: /api-production
    
    env:
      env:
        - name: NODE_ENV
          value: "production"
        - name: LOG_LEVEL
          value: "info"
    
    ingress:
      enabled: true
      annotations:
        nginx.ingress.kubernetes.io/rate-limit: "5000"
        nginx.ingress.kubernetes.io/ssl-redirect: "true"
        nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi
    
    labels:
      monitoring: "critical"
      pagerduty: "enabled"
  
  redis:
    enabled: true
    
    image:
      digest: sha256:fedcba0987654321fedcba0987654321fedcba0987654321fedcba0987654321
    
    replicas: 3
    
    autoscaling:
      enabled: false
    
    persistence:
      enabled: true
      size: 20Gi
      storageClassName: premium-ssd
    
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 4Gi
    
    labels:
      backup: "enabled"
      monitoring: "high"
